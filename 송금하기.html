<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>효빈페이 - 송금하기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f3f4f6;
            -webkit-font-smoothing: antialiased;
            overflow: hidden; /* 키패드 고정을 위해 스크롤 방지 */
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background-color: white;
            height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        /* 금액 입력부 스타일 */
        .amount-display {
            font-size: 3rem;
            font-weight: 700;
            color: #111;
            transition: color 0.2s;
        }
        .amount-display.placeholder {
            color: #d1d5db; /* gray-300 */
        }
        .cursor-blink {
            animation: blink 1s infinite;
            display: inline-block;
            width: 2px;
            height: 3rem;
            background-color: #0047AB;
            vertical-align: middle;
            margin-left: 2px;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* 키패드 스타일 */
        .keypad {
            background-color: #f9fafb;
            padding-bottom: 20px;
        }
        .key-btn {
            height: 60px;
            font-size: 1.5rem;
            font-weight: 500;
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .key-btn:active {
            background-color: #e5e7eb;
        }

        /* 최근 보낸 계좌 가로 스크롤 */
        .recent-scroll {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 10px 4px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .recent-scroll::-webkit-scrollbar {
            display: none;
        }

        /* 모달 애니메이션 */
        .modal-enter {
            animation: slideUp 0.3s ease-out forwards;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .success-icon-anim {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- 헤더 -->
    <header class="flex items-center p-4 bg-white z-10">
        <a href="홈.html" class="text-gray-800 p-2 -ml-2 hover:bg-gray-100 rounded-full transition">
            <i class="fa-solid fa-arrow-left text-xl"></i>
        </a>
        <h1 class="text-lg font-bold ml-2">송금</h1>
        <div class="ml-auto">
            <button class="text-gray-500 text-sm font-medium hover:text-blue-600">더치페이</button>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="flex-1 flex flex-col px-6 pt-4 overflow-y-auto">
        
        <!-- 받는 사람 선택 (입력 전) -->
        <div id="recipient-section" class="mb-6 transition-all duration-300">
            <div class="relative">
                <input type="text" placeholder="계좌번호 또는 연락처 입력" class="w-full bg-gray-100 p-4 rounded-xl text-lg outline-none focus:ring-2 focus:ring-blue-500 transition">
                <button class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                    <i class="fa-solid fa-address-book"></i>
                </button>
            </div>
        </div>

        <!-- 최근 보낸 계좌 (캐릭터) -->
        <div id="recent-section" class="mb-8">
            <h3 class="text-xs font-bold text-gray-500 mb-3">최근 보낸 분</h3>
            <div class="recent-scroll" id="recent-list">
                <!-- JS로 렌더링 -->
            </div>
        </div>

        <!-- 금액 입력부 -->
        <div class="mt-auto mb-6 text-center">
            <div class="flex items-center justify-center relative h-20">
                <span id="amount-text" class="amount-display placeholder">보낼금액</span>
                <span id="currency-unit" class="text-3xl font-bold text-gray-800 ml-1 hidden">원</span>
                <span id="cursor" class="cursor-blink hidden"></span>
            </div>
            <div class="text-sm text-gray-500 mt-2 bg-gray-100 inline-block px-3 py-1 rounded-full">
                잔액 <span class="font-bold text-gray-800">1,543,000원</span>
            </div>
        </div>

    </main>

    <!-- 하단 키패드 -->
    <div class="keypad pb-safe">
        <!-- 빠른 금액 버튼 -->
        <div class="flex gap-2 px-4 py-3 justify-center">
            <button onclick="addAmount(10000)" class="bg-white border border-gray-200 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 active:scale-95 transition">+1만</button>
            <button onclick="addAmount(50000)" class="bg-white border border-gray-200 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 active:scale-95 transition">+5만</button>
            <button onclick="addAmount(100000)" class="bg-white border border-gray-200 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 active:scale-95 transition">+10만</button>
            <button onclick="setFullAmount()" class="bg-white border border-gray-200 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 active:scale-95 transition">전액</button>
        </div>

        <!-- 숫자 키패드 -->
        <div class="grid grid-cols-3">
            <div class="key-btn" onclick="pressKey('1')">1</div>
            <div class="key-btn" onclick="pressKey('2')">2</div>
            <div class="key-btn" onclick="pressKey('3')">3</div>
            <div class="key-btn" onclick="pressKey('4')">4</div>
            <div class="key-btn" onclick="pressKey('5')">5</div>
            <div class="key-btn" onclick="pressKey('6')">6</div>
            <div class="key-btn" onclick="pressKey('7')">7</div>
            <div class="key-btn" onclick="pressKey('8')">8</div>
            <div class="key-btn" onclick="pressKey('9')">9</div>
            <div class="key-btn text-lg" onclick="pressKey('00')">00</div>
            <div class="key-btn" onclick="pressKey('0')">0</div>
            <div class="key-btn" onclick="pressKey('back')"><i class="fa-solid fa-delete-left text-gray-400"></i></div>
        </div>

        <!-- 보내기 버튼 (금액 입력시 활성화) -->
        <div class="px-4 mt-2">
            <button id="send-btn" onclick="confirmTransfer()" class="w-full bg-gray-300 text-white font-bold py-4 rounded-xl text-lg transition-colors cursor-not-allowed" disabled>
                보내기
            </button>
        </div>
    </div>

    <!-- 송금 완료 모달 -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-end sm:items-center justify-center">
        <div class="bg-white w-full max-w-[480px] sm:rounded-2xl rounded-t-2xl p-8 text-center modal-enter">
            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-3xl mx-auto mb-4 success-icon-anim">
                <i class="fa-solid fa-check"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">송금 완료!</h2>
            <p class="text-gray-500 mb-6"><span id="modal-name" class="font-bold text-gray-800">한바다</span>님께 <span id="modal-amount" class="font-bold text-blue-600">0원</span>을<br>성공적으로 보냈습니다.</p>
            
            <div class="bg-gray-50 p-4 rounded-xl mb-6 text-sm flex justify-between">
                <span class="text-gray-500">송금 후 잔액</span>
                <span id="remaining-balance" class="font-bold text-gray-800"></span>
            </div>

            <button onclick="location.href='홈.html'" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition">확인</button>
        </div>
    </div>

</div>

<script>
    // 캐릭터 데이터 (최근 보낸 계좌)
    const recentContacts = [
        { name: "한바다", bank: "효빈은행", acc: "110-382-****", img: "한바다.png" },
        { name: "고나미", bank: "카카오뱅크", acc: "3333-01-****", img: "고나미.png" },
        { name: "하루빈", bank: "국민은행", acc: "920301-01-****", img: "하루빈.png" },
        { name: "박라미", bank: "토스뱅크", acc: "1000-22-****", img: "박라미.png" },
        { name: "다로나", bank: "신한은행", acc: "110-223-****", img: "다로나.png" }
    ];

    let currentAmount = '';
    const MAX_AMOUNT = 1543000; // 현재 잔액
    let selectedName = "한바다"; // 기본 송금 대상

    window.onload = function() {
        renderContacts();
    };

    function renderContacts() {
        const list = document.getElementById('recent-list');
        list.innerHTML = recentContacts.map((contact, index) => `
            <div class="flex flex-col items-center min-w-[60px] cursor-pointer group" onclick="selectContact('${contact.name}')">
                <div class="relative">
                    <img src="${contact.img}" class="w-12 h-12 rounded-full border border-gray-100 object-cover group-hover:border-blue-500 transition" 
                        onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=${contact.name}'">
                    <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-white rounded-full flex items-center justify-center border border-gray-200">
                        <!-- 은행 로고 대신 텍스트 약어 -->
                        <span class="text-[8px] font-bold text-gray-500">${contact.bank.substr(0,1)}</span>
                    </div>
                </div>
                <span class="text-xs mt-2 text-gray-700 font-medium truncate w-14 text-center group-hover:text-blue-600">${contact.name}</span>
            </div>
        `).join('');
    }

    function selectContact(name) {
        selectedName = name;
        // 입력창에 이름 표시 효과 (선택적)
        document.querySelector('input[type="text"]').value = name;
    }

    // 키패드 입력 처리
    function pressKey(key) {
        if (key === 'back') {
            currentAmount = currentAmount.slice(0, -1);
        } else {
            if (currentAmount === '' && key === '00') return; // 처음에 00 입력 방지
            if (currentAmount === '0' && key === '0') return; // 0 중복 방지
            if (currentAmount.length >= 10) return; // 최대 자릿수 제한
            currentAmount += key;
        }
        updateDisplay();
    }

    // 금액 추가 버튼 (+1만 등)
    function addAmount(val) {
        let num = parseInt(currentAmount || 0);
        num += val;
        if (num > MAX_AMOUNT) num = MAX_AMOUNT; // 잔액 초과 방지
        currentAmount = num.toString();
        updateDisplay();
    }

    // 전액 버튼
    function setFullAmount() {
        currentAmount = MAX_AMOUNT.toString();
        updateDisplay();
    }

    // 화면 업데이트
    function updateDisplay() {
        const display = document.getElementById('amount-text');
        const unit = document.getElementById('currency-unit');
        const cursor = document.getElementById('cursor');
        const btn = document.getElementById('send-btn');

        if (currentAmount === '' || parseInt(currentAmount) === 0) {
            display.innerText = "보낼금액";
            display.classList.add('placeholder');
            display.style.color = "#d1d5db";
            unit.classList.add('hidden');
            cursor.classList.add('hidden');
            
            // 버튼 비활성화
            btn.disabled = true;
            btn.className = "w-full bg-gray-300 text-white font-bold py-4 rounded-xl text-lg transition-colors cursor-not-allowed";
        } else {
            // 콤마 포맷팅
            const formatted = parseInt(currentAmount).toLocaleString();
            display.innerText = formatted;
            display.classList.remove('placeholder');
            display.style.color = "#111";
            unit.classList.remove('hidden');
            cursor.classList.remove('hidden');

            // 버튼 활성화
            btn.disabled = false;
            btn.className = "w-full bg-blue-600 text-white font-bold py-4 rounded-xl text-lg hover:bg-blue-700 transition shadow-lg transform active:scale-95";
        }
    }

    // 송금 확인 (모달)
    function confirmTransfer() {
        const amount = parseInt(currentAmount);
        const formattedAmount = amount.toLocaleString();
        const remaining = (MAX_AMOUNT - amount).toLocaleString();

        document.getElementById('modal-name').innerText = selectedName;
        document.getElementById('modal-amount').innerText = formattedAmount + "원";
        document.getElementById('remaining-balance').innerText = remaining + "원";

        document.getElementById('success-modal').classList.remove('hidden');
    }
</script>

</body>
</html>